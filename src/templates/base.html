{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <title>
      {% block title %}

      {% endblock %}
    </title>

    <!-- Meta Tags -->
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta name="author" content="c-sp.kz" />
    <meta name="keywords" content="стальной прокат, металлопрокат Казахстан, ЦСП, металлоконструкции" />
    <meta name="description" content="Центр стального проката ЦСП – металлопрокат в Казахстане. Широкий ассортимент стали и металлоконструкций по доступным ценам." />

    <meta property="og:title" content="ЦСП – Центр стального проката" />
    <meta property="og:description" content="Крупнейший поставщик стального проката в Казахстане." />
    <meta property="og:image" content="https://c-sp.kz/static/images/logotip.png" />
    <meta property="og:url" content="https://c-sp.kz" />
    <meta property="og:type" content="website" />
    <link rel="sitemap" type="application/xml" title="Sitemap" href="https://c-sp.kz/sitemap.xml" />

    <!-- Favicon -->
    <link rel="shortcut icon" href="{% static 'images/logotip.png' %}" />
    <link rel="apple-touch-icon" sizes="180x180" href="{% static 'images/apple-touch-icon.png' %}" />

    <!-- Google Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700&family=Poppins:wght@400;500;700&display=swap" />

    <!-- Plugins CSS -->
    <link rel="stylesheet" type="text/css" href="{% static 'css/all.min.css' %}" />
    <link rel="stylesheet" type="text/css" href="{% static 'css/bootstrap-icons.css' %}" />
    <link rel="stylesheet" type="text/css" href="{% static 'css/tiny-slider.css' %}" />
    <link rel="stylesheet" type="text/css" href="{% static 'css/glightbox.css' %}" />
    <link rel="stylesheet" type="text/css" href="{% static 'css/flatpickr.min.css' %}" />
    <link rel="stylesheet" type="text/css" href="{% static 'css/choices.min.css' %}" />

    <!-- Theme CSS -->
    <link rel="stylesheet" type="text/css" href="{% static 'css/style.css' %}" />

    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "Organization",
        "name": "ЦСП",
        "url": "https://c-sp.kz",
        "logo": "https://c-sp.kz/static/images/logotip.png",
        "description": "Центр стального проката – металлопрокат в Казахстане.",
        "address": {
          "@type": "PostalAddress",
          "streetAddress": "Улица, дом",
          "addressLocality": "Город",
          "addressCountry": "KZ"
        }
      }
      </script>

    {% block extra_head %}
      <!-- Google tag (gtag.js) -->
      <script async src="https://www.googletagmanager.com/gtag/js?id=G-EMLGZR9BB8"></script>
      <script async src="https://www.googletagmanager.com/gtag/js?id=AW-16938977339"></script>

      <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){ dataLayer.push(arguments); }

        // Настройка GA4
        gtag('js', new Date());
        gtag('config', 'G-EMLGZR9BB8'); // GA4

        // Настройка Google Ads
        gtag('config', 'AW-16938977339'); // Google Ads

        document.addEventListener("DOMContentLoaded", function () {
            // Отслеживание кликов по ссылкам (телефон, WhatsApp, email)
            document.body.addEventListener("click", function (event) {
                let target = event.target.closest("a");
                if (!target) return;

                let href = target.getAttribute("href") || "";

                if (href.startsWith("tel:")) {
                    gtag("event", "call_click", { 
                        event_category: "Engagement", 
                        event_label: href
                    });
                } else if (href.startsWith("https://wa.me")) {
                    gtag("event", "whatsapp_click", { 
                        event_category: "Engagement", 
                        event_label: href
                    });
                } else if (href.startsWith("mailto:")) {
                    gtag("event", "email_click", { 
                        event_category: "Engagement", 
                        event_label: href
                    });
                }
            });

            // Отслеживание отправки всех форм
            document.body.addEventListener("submit", function (event) {
                let form = event.target;
                if (!form || form.tagName !== "FORM") return;

                let actionUrl = form.getAttribute("action") || "unknown_form";

                let formData = new FormData(form);
                let formValues = {};
                formData.forEach((value, key) => {
                    formValues[key] = value;
                });

                // Собираем пользовательские данные
                let userData = {
                    name: formValues["name"] || formValues["full_name"] || "",
                    email: formValues["email"] || formValues["user_email"] || "",
                    phone: formValues["phone"] || formValues["user_phone"] || ""
                };

                // Отправка события в GA4
                gtag("event", "form_submit", {
                    event_category: "Form",
                    event_label: actionUrl,
                    method: "submit",
                    form_id: form.getAttribute("id") || "unknown",
                    user_name: userData.name,
                    user_email: userData.email,
                    user_phone: userData.phone
                });

                // Отправка события в Google Ads
                gtag("event", "conversion", {
                    'send_to': 'AW-16938977339/ZjGhCMLh7-YEEMuZ8L8D',
                    'event_category': "Conversion",
                    'event_label': actionUrl,
                    'user_name': userData.name,
                    'user_email': userData.email,
                    'user_phone': userData.phone
                });

                // **Удаляем редирект**, чтобы не мешать работе сайта
            });
        });
      </script>

      <meta name="google-site-verification" content="BvLZ301Bw6adphgfTDU261gx-lqSxKCl5y_tUCukCg0" />
    {% endblock %}
  </head>

  <body>
    <!-- Header START -->
    {% block header %}

    {% endblock %}
    <!-- Header END -->

    <!-- **************** MAIN CONTENT START **************** -->
    {% block content %}

    {% endblock %}
    <!-- **************** MAIN CONTENT END **************** -->

    <!-- ======================= Footer START -->

    <div class="position-absolute top-0 start-0 w-100" style="height: 100px; 
            background: linear-gradient(to bottom, rgba(255, 255, 255, 1) 0%, rgba(255, 255, 255, 0) 100%);
            z-index: 10; pointer-events: none;"></div>

    <footer class="bg-dark py-7" style="border-radius: 25px 25px 0px 0px;">
      <div class="container">
        <div class="row mx-auto">
          <div class="col-lg-6 mx-auto text-center">
            <!-- Logo -->
            <img class="mx-auto h-60px" src="{% static 'images/logotip.png' %}" style="filter: drop-shadow(0px 0px 12px white);" alt="logo" />

            <p class="mt-3 text-white">ТОО "Центр Стального Проката" — ваш надежный партнер в сфере комплексных поставок строительных материалов.</p>
            <!-- Links -->
            <ul class="nav justify-content-between text-primary-hover mt-3 mt-md-0">
              <li class="nav-item">
                <a class="nav-link p-2 text-white" href="/">Главная</a>
              </li>
              <li class="nav-item">
                <a class="nav-link p-2 text-white" href="{% url 'website:category' %}">Каталог</a>
              </li>
              <li class="nav-item">
                <a class="nav-link p-2 text-white" href="{% url 'website:services' %}">Услуги</a>
              </li>
              <li class="nav-item">
                <a class="nav-link p-2 text-white" href="{% url 'website:contacts' %}">Контакты</a>
              </li>
              <li class="nav-item">
                <a class="nav-link p-2 text-white" href="{% url 'website:about' %}">О компании</a>
              </li>
            </ul>
            <!-- Social media button -->
            <ul class="list-inline mt-3 mb-0">
              <li class="list-inline-item">
                <a class="btn btn-white btn-sm shadow px-2 text-instagram" href="https://www.instagram.com/csp.almaty/"><i class="fab fa-fw fa-instagram"></i></a>
              </li>
            </ul>
            <!-- copyright text -->
            <div class="text-body-secondary text-primary-hover mt-3">
              Copyrights ©2025 IT. Build by <a href="https://www.instagram.com/tab1kkz/" class="text-body-secondary">Tabigat Karbayev.</a>.
            </div>
          </div>
        </div>
      </div>
    </footer>

    <style>
      footer {
        background: linear-gradient(to top, #032655, rgba(255, 255, 255, 0));
        color: #032655; /* Задаем цвет текста */
        padding: 20px;
        text-align: center;
        backdrop-filter: blur(10px); /* Добавляем размытие */
        position: relative;
      }
    </style>
    <!--     =======================
Footer END     -->

    <!-- Контейнер WhatsApp-кнопки с облаком -->
    <div id="whatsapp-container">
      <a href="https://wa.me/77088009874?text=👋%20Здравствуйте!%20Я%20пишу%20вам%20с%20*c-sp.kz*.%20хочу%20узнать%20подробнее%20о%20ваших%20услугах%20🚀" class="whatsapp-float" target="_blank"><i class="fab fa-whatsapp"></i></a>
      <div class="whatsapp-bubble">💬 Привет! Напишите нам, мы поможем!</div>
    </div>

    <!-- Стили для кнопки и облака -->
    <style>
      /* Контейнер WhatsApp */
      #whatsapp-container {
        position: fixed;
        bottom: 20px;
        right: 20px;
        z-index: 9999;
        display: flex;
        flex-direction: column;
        align-items: center;
      }

      /* Кнопка WhatsApp */
      .whatsapp-float {
        background-color: #25D366;
        color: white;
        width: 60px;
        height: 60px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 30px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
        text-decoration: none;
        transition: transform 0.3s ease;
      }

      /* Анимация звонка */
      @keyframes ring {
        0% { transform: rotate(0deg); }
        10% { transform: rotate(-10deg); }
        20% { transform: rotate(10deg); }
        30% { transform: rotate(-10deg); }
        40% { transform: rotate(10deg); }
        50% { transform: rotate(0deg); }
      }

      /* При наведении анимация отключается */
      .whatsapp-float:hover {
        transform: scale(1.1);
        animation: none;
      }

      /* Всплывающее облако */
      .whatsapp-bubble {
        background: white;
        color: #333;
        padding: 10px 15px;
        border-radius: 15px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
        font-size: 14px;
        position: absolute;
        bottom: 75px;
        right: 10px;
        opacity: 0;
        transition: opacity 0.5s ease, transform 0.5s ease;
        transform: translateY(10px);
        white-space: nowrap;
      }

      /* Показываем облако */
      .whatsapp-bubble.show {
        opacity: 1;
        transform: translateY(0);
      }
    </style>

    <!-- Скрипт для появления облака и звонка -->
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const whatsappBtn = document.querySelector(".whatsapp-float");
        const whatsappBubble = document.querySelector(".whatsapp-bubble");
    
        function startRingAnimation() {
          whatsappBtn.style.animation = "ring 1.5s";
          setTimeout(() => { whatsappBtn.style.animation = ""; }, 1500);
        }
    
        function showBubble() {
          const lastShown = localStorage.getItem("whatsappLastShown");
          const now = Date.now();
    
          if (!lastShown || now - lastShown > 15000) { // 15 секунд прошло?
            whatsappBubble.classList.add("show");
            localStorage.setItem("whatsappLastShown", now);
    
            setTimeout(() => {
              whatsappBubble.classList.remove("show");
            }, 5000);
          }
        }
    
        // 🛑 Если пользователь наводит курсор на WhatsApp, облако скрывается
        whatsappBtn.addEventListener("mouseenter", function () {
          whatsappBubble.classList.remove("show");
        });
    
        // 🔁 Показываем облако раз в 15 секунд (но не сразу)
        setInterval(showBubble, 15000);
    
        // 🔁 Запускаем звонок каждые 10 секунд
        setInterval(startRingAnimation, 2000);
      });
    </script>
    

    <!-- Bootstrap JS -->
    <script src="{% static 'js/bootstrap.bundle.min.js' %}"></script>

    <!-- Vendors -->
    <script src="{% static 'js/tiny-slider.js' %}"></script>
    <script src="{% static 'js/purecounter_vanilla.js' %}"></script>
    <script src="{% static 'js/glightbox.js' %}"></script>
    <script src="{% static 'js/flatpickr.min.js' %}"></script>
    <script src="{% static 'js/choices.min.js' %}"></script>
    <script src="{% static 'js/jarallax.min.js' %}"></script>
    <script src="{% static 'js/jarallax-video.min.js' %}"></script>

    <!-- ThemeFunctions -->
    <script src="{% static 'js/functions.js' %}"></script>
  </body>
</html>
